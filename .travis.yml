language: node_js
dist: trusty
sudo: true
node_js:
- 7.5.0
addons:
  apt:
    packages:
    - python-pip
notifications:
  email: false
  slack:
    rooms:
    - gapminder:siB4Z9ymsYR6qHnRPpgUoB2Q#vizabi-spam
    on_success: change
    on_failure: always
cache:
  directories:
  - node_modules
before_install:
- npm install -g npm@latest
- sudo pip install s3cmd
before_script:
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- npm run build
script:
- npm run deploy
deploy:
  skip_cleanup: true
  provider: npm
  email: kgrpwnz@gmail.com
  api_key:
    secure: qga696bctrVDFoeHgPGR55GVrPEn3v6Qfj4e/Qrbb0dKMW7majvXHjQN351zvWbWfUscRJL7bCGVr+Uo0rq57GGV0Lu4w7E1/WRYkSfM48/4yk9MIiBv+GJHk6gU9BdqHXfpOQ7AlOedHc+KPsOdtVaDIqEEN1FC5eV6aV7vZYDT1z43mceXhDY8CG0l9wtCnbi6RTD94c3bSimatYCqQlBqiaCA3oNrGpF4j46Oshm8P46IOfeW+5yEu9bIY1LZmHvide2Dc+HO4ewDvpmyMyTwx51xi4Qa66VakQ7WXP8mKQa/Fzffh4Zo7K6sI4rbkMj0+Y/cMoaXH9PkL+t8n2L6N6i180Kmh6qdXmC1kAuABNn78U0xBjumQqrWIVLNzstbS33iu0bHRK2GEzliapqRLEEFgYTn86Cw+k6LIWFYYcSo9MIX3iGUQmfCpFDUWHpBM1OGeNv7w55A4LiEQE3kxHIWVyMDki9eF9ZpWvaihHVZEhxsJabPN4Jk1HkrT/fAKdL79yLPbfrXqeKEoMx0t6BUZTWnqIFgRDc+RISaMg4ay2t7UfhfcShIur3MSUTU8IsPZxM8dZxkw/qWIFwfM+5eZ2qP1FP/mjulLnfGhrmGzXgBF22MftQMrM4+7P3cokBdmtXPfBed7QDBpHH+Gcz0uPAYfAM9PbXGVUM=
  on:
    branch: develop
    node: 7.5.0
    condition: "-e /tmp/deployment.flag"
