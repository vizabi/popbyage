language: node_js
dist: trusty
sudo: true
node_js:
- 7.5.0
addons:
  apt:
    packages:
    - python-pip
notifications:
  email: false
  slack:
    rooms:
    - gapminder:siB4Z9ymsYR6qHnRPpgUoB2Q#vizabi-spam
    on_success: change
    on_failure: always
cache:
  directories:
  - node_modules
before_install:
- npm install -g npm@latest
- sudo pip install s3cmd
before_script:
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- npm run build
script:
- npm run deploy
deploy:
  skip_cleanup: true
  provider: npm
  email: kgrpwnz@gmail.com
  api_key:
    secure: HLGCwIDpfrDNfzXZrKpg2fDk4IHmsKNJ69HP2ay2e3sVnJjVjfULtkOWjMaCJZqmGOpwTwI8vsCgBE4YytsWW2TLrPFGxcfstWfR2TpxHt5bV235es+Iu7jR6YL3D2RIisEa9rfzKV2bzDOg8Mwj52rSF+KnmIMiSQiS03BkFW09O7lwvzE2BE8Zij1fsovO1gFvv462A3TsJYFeotCK6aN0GNWSZt1etBY8IA+Ld+22c/gJh4W/vvt1fOElnwfud60Q0ZKbAWL6V1uqU4x1dDXTE7fExFtaVeCV7V+ek2ejdXgLnnt3NP/riV2GVxqSfC54OQcGtU4sepIAorG/VXrraJh6rIkEuK3w3+g0f0GEGmPFFx0ojuOtdsaZ5X+tzQATJfwW3mZ8nb2Ybjriw8uo2dQLiukfBOk92nQIrnl0e9UCwm0zBcyXoxt1BJZDVbweaJI9xnxdkNDyCaLBwb8FZKwlGEEyvcW0VE97GCURC02rZDNEQgI9XToTQXp9fWXGV4evD8kE3ZhUewMOW0agV5nRwfLIy9QtA+3lerWZukqVmkhxthGmyBR3x4RxVC0Bs3qh3EAM+IRZzkd+FKM+ogjh0bfQBM2zRN4HJWgfWWOReYnZ7OreTZHm0hkeZKIOFL0rIfDscIjwXcTqnnz9l5Iwec0cS5TpJ5Iasjo=
  on:
    branch: develop
    node: 7.5.0
    condition: "-e /tmp/deployment.flag"
